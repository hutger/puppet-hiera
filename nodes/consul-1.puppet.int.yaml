---
classes:
  - roles::haproxy::server
  - roles::squid::server


roles::haproxy::server::frontends:
  prx01-dev_http:
    ipaddress : "%{::ipaddress}"
    ports     : '8080'
    mode      : http
    options:
      # Permanent redirect from http to https
      'default_backend'        : 'prx01-dev_http_backend'
      'redirect scheme'        : 'https code 301 if !{ ssl_fc }'
      'capture request header' : 'X-Forwarded-For len 50'
      option                   : [ 'http-server-close' ]
    collect_exported : false


roles::haproxy::server::backends:
  prx01-dev_http_backend:
    mode      : http
    options:
      'balance'        : 'roundrobin'
      option           : [ 'httplog', 'http-server-close' ]


roles::haproxy::server::balancermembers:
  server00:
    listening_service : 'prx01-dev_http_backend'
    server_names      : [ 'server01', 'server02' ] 
    ipaddresses       : [ '10.0.0.10', '10.0.0.11' ]
    ports             : '8080'
    options           : ''




roles::squid::server::squid_basics:
  cache_mem    : '512 MB'
  workers      : '3'
  coredump_dir : '/var/spool/squid'

roles::squid::server::cache_dir:
  /data:
    type           : 'ufs'
    options        : '15000 32 256 min-size=32769'
    process_number : 2